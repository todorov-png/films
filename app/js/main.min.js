"use strict";function callPopUp(e){const t=document.createElement("div"),n=document.createElement("p"),o=document.querySelector("body"),l=document.querySelector(".pop-up-notification");null!==l&&l.remove(),t.classList.add("pop-up-notification"),n.classList.add("pop-up-notification__text"),n.textContent=e,n.style.margin="0 auto",n.zIndex=1e5,t.append(n),o.insertAdjacentElement("afterBegin",t),smoothTransparencyChange(t,1500,50)}function smoothTransparencyChange(e,t,n){let o=1;setTimeout(()=>{setTimeout((function t(){o<0?e.remove():(e.style.opacity=o,o-=.05,setTimeout(t,n))}),n)},t)}function formToJSON(e){const t=new FormData(e);return JSON.stringify(Object.fromEntries(t.entries()))}function addLocalStorage(e,t){let n=[];localStorage.getItem(t)&&(n=JSON.parse(localStorage.getItem(t))),n.push(e),localStorage.setItem(t,JSON.stringify(n))}function smoothJumpUp(){(document.body.scrollTop>0||document.documentElement.scrollTop>0)&&(window.scrollBy(0,-40),setTimeout(smoothJumpUp,10))}function createForm(){const e=document.querySelector(".content");if(e){const t=document.createElement("form");t.classList.add("form-add-film"),t.innerHTML='\n    <div class="form-add-film__row">\n        <label for="film-title">title</label>\n        <input id="film-title" type="text" name="title" placeholder="Enter the title of the movie" required tabindex="1">\n    </div>\n    <div class="form-add-film__row">\n        <label for="film-year">year</label>\n        <input id="film-year" type="number" name="year" placeholder="Enter the year the movie was released" min="1900" max="2100" maxlength="4" pattern="[0-9]{4}" required tabindex="2">\n    </div>\n    <div class="form-add-film__row">\n        <label for="film-country">country</label>\n        <input id="film-country" type="text" name="country" placeholder="Enter the country of the movie" required tabindex="3">\n    </div>\n    <div class="form-add-film__row">\n        <label for="film-genre">genre</label>\n        <input id="film-genre" type="text" name="genre" placeholder="Enter the genre of the movie" required tabindex="4">\n    </div>\n    <div class="form-add-film__row">\n        <label for="film-poster">poster (link)</label>\n        <input id="film-poster" type="text" name="poster" placeholder="Enter the link to the movie poster" required tabindex="5">\n    </div>\n    <div class="form-add-film__row">\n        <label for="description">description</label>\n        <textarea name="description" id="film-description" placeholder="Enter a description of the movie" required maxlength="3000" tabindex="6"></textarea>\n    </div>\n    <div class="form-add-film__row">\n        <button class="form-add-film__row-btn btn btn-red btn-cancel" type="button" name="cancel" tabindex="6">Cancel</button>\n        <button class="form-add-film__row-btn btn btn-blue" type="submit" name="add" tabindex="7">Add</button>\n    </div>\n    ',e.prepend(t),t.querySelector(".btn-cancel").addEventListener("click",()=>{toggleShowFormAddFilm()}),processingFormAddFilm(t)}}function UpdatePositionContent(){const e=document.querySelector(".header"),t=document.querySelector(".content");e&&(e.clientWidth>=950?t.style.margin=`0 ${e.querySelector(".header__item-logo").clientWidth}px`:t.style.margin="0")}function processingFormAddFilm(e){e.addEventListener("submit",t=>{t.preventDefault();const n=JSON.parse(formToJSON(e)),o=JSON.parse(localStorage.getItem("films"));if("Add"===e.querySelector(".form-add-film__row-btn.btn-blue").innerText)o&&o.some(e=>e.title===n.title)?callPopUp("Such a film is already in the database"):(n.comments=[],e.reset(),callPopUp("Successful"),addFilmItem(n),addLocalStorage(n,"films"),toggleShowFormAddFilm());else if(o&&localStorage.getItem("edit_post")){const e=localStorage.getItem("edit_post");o.forEach((t,l)=>{t.title===e&&(n.comments=o[l].comments,o[l]=n,localStorage.setItem("films",JSON.stringify(o)),localStorage.removeItem("edit_post"),updatePost(n,e),toggleShowFormAddFilm())}),callPopUp("Successful")}})}function processingFormCommentsFilm(e){const t=e.querySelector(".film-comments__block-form");t.addEventListener("submit",n=>{n.preventDefault();const o=JSON.parse(formToJSON(t)),l=JSON.parse(localStorage.getItem("films")),r=e.getAttribute("data-name");l&&l.forEach((e,t)=>{e.title===r&&(l[t].comments.push(o.comment),updateComments(getFilm(r),l[t].comments),localStorage.setItem("films",JSON.stringify(l)))}),t.reset()})}function updateComments(e,t){e.querySelector(".film-comments__counter").innerText=t.length;const n=e.querySelector(".film-comments__block-history");let o='<hr color="#e4edf4"/>';t.forEach(e=>{o+=`<p class="film-comments__block-history-comment">${e}</p><hr color="#e4edf4"/>`}),n.innerHTML=o}function addFilmItem(e){const t=document.querySelector(".content");if(t){const n=document.createElement("div");n.classList.add("film"),n.setAttribute("data-name",e.title),n.innerHTML=`\n      <div class="film-content" style="background: url('${e.poster}'); background-size: 300%; background-position: center;">\n          <div class="film-content__img">\n              <img src="${e.poster}" alt="">\n          </div>\n          <div class="film-content__text">\n              <p class="film-content__text-name">${e.title}</p>\n              <p class="film-content__text-description">${e.description}</p>\n              <table class="film-content__text-table">\n                  <tr>\n                      <td class="film-content__text-table-heading">Country</td>\n                      <td class="film-content__text-table-country">${e.country}</td>\n                  </tr>\n                  <tr>\n                      <td class="film-content__text-table-heading">Year</td>\n                      <td class="film-content__text-table-year">${e.year}</td>\n                  </tr>\n                  <tr>\n                      <td class="film-content__text-table-heading">Genre</td>\n                      <td class="film-content__text-table-genre">${e.genre}</td>\n                  </tr>\n              </table>\n              <div class="film-content__text-btn">\n                  <button class="btn btn-red btn-delete" type="button" name="delete">Delete</button>\n                  <button class="btn btn-blue btn-edit" type="button" name="edit">Edit</button>\n              </div>\n          </div>\n      </div>\n      <div class="film-comments">\n          <a href="javascript:void(0);" class="film-comments__btn-show" data-state="close"">\n              Comments: <span class="film-comments__counter">0</span> <span class="film-comments__state">&and;</span>\n          </a>\n          <div class="film-comments__block">\n              <div class="film-comments__block-history">\n                  <hr color="#e4edf4"/>\n              </div>\n              <form class="film-comments__block-form">\n                  <input id="comment" type="text" name="comment" placeholder="Add your comment" required>\n                  <button class="btn btn-blue btn-add" type="submit" name="add" data-name="${e.title}">Add</button>\n              </form>\n          </div>\n      </div>\n      `,t.append(n),processingFormCommentsFilm(n),updateComments(n,e.comments),n.querySelector(".btn-delete").addEventListener("click",()=>{deletePostFilm(n,e.title)}),n.querySelector(".btn-edit").addEventListener("click",()=>{editPostFilm(e)}),n.querySelector(".film-comments__btn-show").addEventListener("click",()=>{toggleShowComments(n.getAttribute("data-name"))})}}function renderFilmsOfLocalStorage(){if(localStorage.getItem("films")){JSON.parse(localStorage.getItem("films")).forEach(e=>{addFilmItem(e)})}}function getFilm(e){let t;return document.querySelectorAll(".film").forEach(n=>{n.getAttribute("data-name")===e&&(t=n)}),t}function deletePostFilm(e,t){e.remove(),removeLocalStorageFilm(t)}function removeLocalStorageFilm(e){if(localStorage.getItem("films")){const t=JSON.parse(localStorage.getItem("films"));t.forEach((n,o)=>{n.title===e&&(t.splice(o,1),localStorage.setItem("films",JSON.stringify(t)))})}}function editPostFilm(e){const t=document.querySelector(".form-add-film"),n=document.querySelector(".header__item-btn"),o=n.querySelector(".header__item-btn-circle"),l=n.querySelector(".header__item-btn-text");t.querySelector(".form-add-film__row-btn.btn-blue").innerText="Edit",t.querySelector("#film-title").value=e.title,t.querySelector("#film-year").value=e.year,t.querySelector("#film-country").value=e.country,t.querySelector("#film-genre").value=e.genre,t.querySelector("#film-poster").value=e.poster,t.querySelector("#film-description").value=e.description,localStorage.setItem("edit_post",e.title),n.setAttribute("data-state","open"),o.innerHTML="&times;",l.textContent="Close form",t.style.display="block",smoothJumpUp()}function updatePost(e,t){document.querySelectorAll(".film").forEach(n=>{n.getAttribute("data-name")===t&&(n.setAttribute("data-name",e.title),n.querySelector(".film-content__text-name").innerText=e.title,n.querySelector(".film-content__text-table-year").innerText=e.year,n.querySelector(".film-content__text-table-country").innerText=e.country,n.querySelector(".film-content__text-table-genre").innerText=e.genre,n.querySelector(".film-content").style.cssText=`background: url('${e.poster}'); background-size: 300%; background-position: center;`,n.querySelector(".film-content__img img").src=e.poster,n.querySelector(".film-content__text-description").innerText=e.description)})}function toggleShowFormAddFilm(){const e=document.querySelector(".form-add-film"),t=document.querySelector(".header__item-btn"),n=t.querySelector(".header__item-btn-circle"),o=t.querySelector(".header__item-btn-text");"close"===t.getAttribute("data-state")?(t.setAttribute("data-state","open"),n.innerHTML="&times;",o.textContent="Close form",e.style.display="block","Edit"===e.querySelector(".form-add-film__row-btn.btn-blue").innerText&&(e.reset(),e.querySelector(".form-add-film__row-btn.btn-blue").innerText="Add")):(t.setAttribute("data-state","close"),n.innerHTML="&plus;",o.textContent="Add new film",e.style.display="none"),UpdatePositionContent()}function toggleShowComments(e){const t=getFilm(e),n=t.querySelector(".film-comments__btn-show"),o=t.querySelector(".film-comments__state"),l=t.querySelector(".film-comments__block");"close"===n.getAttribute("data-state")?(n.setAttribute("data-state","open"),o.innerHTML="&or;",l.style.display="block"):(n.setAttribute("data-state","close"),o.innerHTML="&and;",l.style.display="none")}window.onload=()=>{renderFilmsOfLocalStorage(),UpdatePositionContent(),createForm()},window.addEventListener("resize",()=>{UpdatePositionContent()});